<!DOCTYPE html>
<html>
<head>
    <title>Blackjack Game</title>
    <style>
        body { font-family: Arial, sans-serif; }
        .container { max-width: 600px; margin: auto; text-align: center; }
        .button { margin: 5px; padding: 10px; font-size: 16px; }
        #results { margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Blackjack Game</h1>
        <div>
            <label for="betAmount">Bet Amount ($5 to $10): </label>
            <input type="number" id="betAmount" min="5" max="10" step="1">
            <button class="button" onclick="startGame()">Start Game</button>
        </div>
        <div id="gameInfo">
            <p id="balance"></p>
            <p id="playerHand"></p>
            <p id="dealerHand"></p>
            <p id="gameStatus"></p>
        </div>
        <div id="playerActions" style="display: none;">
            <button class="button" onclick="playerAction('hit')">Hit</button>
            <button class="button" onclick="playerAction('stand')">Stand</button>
        </div>
        <div id="results">
            <button class="button" onclick="downloadCSV()">Download Results</button>
            <textarea id="resultData" rows="10" cols="50" readonly></textarea>
        </div>
    </div>

    <script>
        let suits = ['Hearts', 'Diamonds', 'Clubs', 'Spades'];
        let ranks = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
        let values = {'2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9, '10': 10, 'J': 10, 'Q': 10, 'K': 10, 'A': 11};
        let deck = [];
        let playerHand = [];
        let dealerHand = [];
        let playerBalance = 50;
        let betAmount = 0;
        let gameStatus = '';
        let roundData = [];

        function createDeck() {
            deck = [];
            for (let suit of suits) {
                for (let rank of ranks) {
                    deck.push({ rank: rank, suit: suit });
                }
            }
            deck.sort(() => Math.random() - 0.5);
        }

        function calculateHandValue(hand) {
            let value = hand.reduce((sum, card) => sum + values[card.rank], 0);
            let numAces = hand.filter(card => card.rank === 'A').length;
            while (value > 21 && numAces > 0) {
                value -= 10;
                numAces--;
            }
            return value;
        }

        function dealCard() {
            return deck.pop();
        }

        function displayHand(hand) {
            return hand.map(card => `${card.rank} of ${card.suit}`).join(' | ');
        }

        function startGame() {
            betAmount = parseInt(document.getElementById('betAmount').value);
            if (betAmount < 5 || betAmount > 10 || betAmount > playerBalance) {
                alert("Invalid bet amount. Please enter a bet between $5 and $10.");
                return;
            }

            createDeck();
            playerHand = [dealCard(), dealCard()];
            dealerHand = [dealCard(), dealCard()];

            updateGameInfo();
            document.getElementById('playerActions').style.display = 'block';
        }

        function updateGameInfo() {
            document.getElementById('balance').textContent = `Balance: $${playerBalance}`;
            document.getElementById('playerHand').textContent = `Player Hand: ${displayHand(playerHand)} (Value: ${calculateHandValue(playerHand)})`;
            document.getElementById('dealerHand').textContent = `Dealer Hand: ${dealerHand[0].rank} of ${dealerHand[0].suit} | ? of ?`;
            document.getElementById('gameStatus').textContent = gameStatus;
        }

        function playerAction(action) {
            if (action === 'hit') {
                playerHand.push(dealCard());
                if (calculateHandValue(playerHand) > 21) {
                    endGame('Player Busts');
                } else {
                    updateGameInfo();
                }
            } else if (action === 'stand') {
                while (calculateHandValue(dealerHand) < 17) {
                    dealerHand.push(dealCard());
                }
                endGame(determineWinner());
            }
        }

        function determineWinner() {
            let playerValue = calculateHandValue(playerHand);
            let dealerValue = calculateHandValue(dealerHand);
            if (dealerValue > 21 || playerValue > dealerValue) {
                playerBalance += betAmount;
                return 'Player Wins';
            } else if (playerValue < dealerValue) {
                playerBalance -= betAmount;
                return 'Dealer Wins';
            } else {
                return 'Tie';
            }
        }

        function endGame(result) {
            gameStatus = result;
            updateGameInfo();
            document.getElementById('dealerHand').textContent = `Dealer Hand: ${displayHand(dealerHand)} (Value: ${calculateHandValue(dealerHand)})`;
            roundData.push({
                'Round': roundData.length + 1,
                'Bet': betAmount,
                'Player Hand': displayHand(playerHand),
                'Dealer Hand': displayHand(dealerHand),
                'Result': result,
                'Balance': playerBalance
            });
            document.getElementById('playerActions').style.display = 'none';
            document.getElementById('resultData').value = JSON.stringify(roundData, null, 2);
        }

        function downloadCSV() {
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Round,Bet,Player Hand,Dealer Hand,Result,Balance\n";
            roundData.forEach(row => {
                csvContent += `${row.Round},${row.Bet},"${row['Player Hand']}","${row['Dealer Hand']}",${row.Result},${row.Balance}\n`;
            });
            let encodedUri = encodeURI(csvContent);
            let link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "blackjack_results.csv");
            document.body.appendChild(link);
            link.click();
        }
    </script>
</body>
</html>
